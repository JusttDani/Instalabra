{% extends 'base.html.twig' %}
{% block title %}Mensajes{% endblock %}
{% block body %}

<div class="mensajes-lista">
    {% for conversation in conversations %}
        {% set contact = conversation.user %}
        {% set lastMsg = conversation.lastMessage %}
        {% set esPropio = lastMsg.remitente.id == app.user.id %}

        <a href="{{ path('app_chat_show', {id: contact.id}) }}" class="conversacion-item">

            <div class="conversacion-avatar-wrapper">
                <img src="{{ contact.fotoPerfil ? asset('uploads/perfiles/' ~ contact.fotoPerfil) : asset('multimedia/Prueba/noicon.jpg') }}"
                     alt="{{ contact.nombre }}"
                     class="conversacion-avatar">
                <span class="conversacion-online"></span>
            </div>

            <div class="conversacion-info">
                <div class="conversacion-top">
                    <span class="conversacion-nombre">{{ contact.nombre }}</span>
                    <span class="conversacion-fecha">{{ lastMsg.fechaEnvio|date('d/m/Y') }}</span>
                </div>
                <div class="conversacion-preview">
                    <span class="conversacion-ultimo">
                        {% if esPropio %}Tú: {% endif %}
                        {% if lastMsg.palabraCompartida %}
                             Publicación compartida
                        {% else %}
                            {{ lastMsg.contenido|slice(0, 45) }}{% if lastMsg.contenido|length > 45 %}...{% endif %}
                        {% endif %}
                    </span>
                </div>
            </div>

            <div class="conversacion-arrow">›</div>

        </a>

    {% else %}
        <div class="mensajes-empty">
            <span class="empty-icon"></span>
            <p class="empty-title">Sin mensajes aún</p>
            <p class="empty-subtitle">Visita el perfil de alguien para empezar una conversación</p>
        </div>
    {% endfor %}
</div>

{% endblock %}