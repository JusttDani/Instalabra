{% extends 'base.html.twig' %}
{% block title %}Compartir publicaciÃ³n{% endblock %}

{% block body %}
<div class="share-header">
    <a href="javascript:history.back()" class="share-back">â€¹</a>
    <h1 class="share-titulo">Compartir</h1>
</div>

<div class="share-page">

    {# â”€â”€ Preview de la publicaciÃ³n â”€â”€ #}
    <div class="share-preview">
        <div class="share-preview-autor">
            <img class="share-preview-avatar"
                 src="{{ palabra.usuario.fotoPerfil
                     ? asset('uploads/perfiles/' ~ palabra.usuario.fotoPerfil)
                     : asset('multimedia/Prueba/noicon.jpg') }}"
                 alt="{{ palabra.usuario.nombre }}">
            <div class="share-preview-info">
                <span class="share-preview-nombre">{{ palabra.usuario.nombre }}</span>
                <span class="share-preview-fecha">{{ palabra.fechaCreacion|date('d M Y') }}</span>
            </div>
        </div>
        <div class="share-preview-contenido">
            <p class="share-preview-palabra">{{ palabra.palabra }}</p>
            <p class="share-preview-definicion">{{ palabra.definicion }}</p>
        </div>
    </div>

    {# â”€â”€ Buscador â”€â”€ #}
    {% if users is not empty %}
    <div class="share-search-wrap">
        <svg class="share-search-icon" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"/>
            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <input type="text"
               id="share-search"
               class="share-search-input"
               placeholder="Busca un usuario..."
               autocomplete="off"
               autofocus>
        <button type="button" class="share-search-clear" id="share-search-clear" style="display:none;"
                onclick="clearSearch()">âœ•</button>
    </div>
    {% endif %}

    {# â”€â”€ TÃ­tulo secciÃ³n â”€â”€ #}
    <div class="share-seccion-titulo" id="share-seccion-titulo">
        {% if users is not empty %}Siguiendo{% endif %}
    </div>

    {# â”€â”€ Lista de usuarios â”€â”€ #}
    {% if users is empty %}
        <div class="share-empty">
            <span class="share-empty-icon">ğŸ‘¤</span>
            <p class="share-empty-texto">No sigues a nadie todavÃ­a</p>
            <p class="share-empty-sub">Sigue a usuarios para poder compartir publicaciones</p>
        </div>
    {% else %}
        <div id="share-no-results" class="share-empty" style="display:none;">
            <span class="share-empty-icon">ğŸ”</span>
            <p class="share-empty-texto">Sin resultados</p>
            <p class="share-empty-sub">Prueba con otro nombre</p>
        </div>

        <ul class="share-lista" id="share-lista">
            {% for user in users %}
            <li class="share-item" id="item-{{ user.id }}"
                data-nombre="{{ user.nombre|lower }}">

                <div class="share-user">
                    <img class="share-avatar"
                         src="{{ user.fotoPerfil
                             ? asset('uploads/perfiles/' ~ user.fotoPerfil)
                             : asset('multimedia/Prueba/noicon.jpg') }}"
                         alt="{{ user.nombre }}">
                    <div class="share-user-info">
                        <span class="share-user-nombre">{{ user.nombre }}</span>
                    </div>
                </div>

                <form action="{{ path('app_chat_send', {id: user.id}) }}"
                      method="post"
                      class="share-form">
                    <input type="hidden" name="shared_post_id" value="{{ palabra.id }}">
                    <input type="hidden" name="content" class="share-msg-hidden" value="">

                    <div class="share-actions">
                        <button type="button"
                                class="share-btn-msg"
                                id="btn-msg-{{ user.id }}"
                                onclick="toggleMsg({{ user.id }})">
                            <span class="share-btn-msg-label">Mensaje</span>
                            <svg class="share-chevron" viewBox="0 0 24 24" fill="none"
                                 stroke="currentColor" stroke-width="2.5"
                                 stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="6 9 12 15 18 9"/>
                            </svg>
                        </button>
                        <button type="submit" class="share-btn-send">Enviar</button>
                    </div>

                    <div class="share-msg-wrap" id="msg-{{ user.id }}" style="display:none;">
                        <input type="text"
                               class="share-msg-input"
                               placeholder="AÃ±ade un mensaje..."
                               oninput="this.closest('form').querySelector('.share-msg-hidden').value = this.value">
                    </div>
                </form>
            </li>
            {% endfor %}
        </ul>
    {% endif %}

</div>
{% endblock %}
