<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>
			{% block title %}Instalabra
			{% endblock %}
		</title>

		<!-- Links -->
		<link
		rel="icon" type="image/png" href="{{ asset('multimedia/logo.png') }}">
		<!-- Linking the correct CSS file -->
		<link rel="stylesheet" href="{{ asset('css/estilos.css') }}"> {% block stylesheets %}{% endblock %}
		<link rel="stylesheet" href="{{ asset('css/wordle.css') }}">
		<link rel="stylesheet" href="{{ asset('css/darkmode.css') }}">
		<link rel="stylesheet" href="{{ asset('css/sidebar.css') }}">

		<!-- Theme Detection Script (Anti-flicker) -->
		<script>
			(function () {
			const theme = localStorage.getItem('theme') || 'light';
			if (theme === 'dark') {
			document.documentElement.classList.add('dark-mode');
			document.body.classList.add('dark-mode');
			}
			})();
		</script>
		<!-- Hotwire Turbo for SPA Navigation -->
		<meta name="turbo-cache-control" content="no-cache">
		<script type="module">
			import hotwiredTurbo from 'https://cdn.jsdelivr.net/npm/@hotwired/turbo@8.0.4/+esm';
		</script>

		<!-- Fuentes -->
		<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"> {% block javascripts %}{% endblock %}

		<!-- Scripts -->
		<script src="{{ asset('js/instalabra.js') }}" defer></script>
		<script src="{{ asset('js/menu.js') }}" defer></script>
		<script src="{{ asset('js/wordle.js') }}" defer></script>
	</head>

	<body>
		<div class="container">
			<!-- Barra lateral izquierda -->
			<aside class="menu-bar-left">
				<div class="logo">
					<a href="{{ path('app_home') }}">
						<img src="{{ asset('multimedia/logo.png') }}" alt="Logo de Instalabra">
					</a>
				</div>

				<nav class="menu">
					<ul>
						<li>
							<a href="{{ path('app_home') }}" title="Inicio">
								<span class="nav-icon">
									<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
										<path d="M3 9.5L12 3l9 6.5V20a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V9.5z"/>
										<polyline points="9 21 9 12 15 12 15 21"/>
									</svg>
								</span>
								<span class="nav-label">Inicio</span>
							</a>
						</li>
						<li>
							<a href="{{ path('app_ranking') }}" title="Ranking">
								<span class="nav-icon">
									<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
										<line x1="18" y1="20" x2="18" y2="10"/>
										<line x1="12" y1="20" x2="12" y2="4"/>
										<line x1="6" y1="20" x2="6" y2="14"/>
									</svg>
								</span>
								<span class="nav-label">Ranking</span>
							</a>
						</li>
						<li>
							<a href="{{ path('app_explorar') }}" title="Explorar">
								<span class="nav-icon">
									<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
										<circle cx="11" cy="11" r="8"/>
										<line x1="21" y1="21" x2="16.65" y2="16.65"/>
									</svg>
								</span>
								<span class="nav-label">Explorar</span>
							</a>
						</li>
						<li>
							<a href="{{ path('app_chat_index') }}" title="Mensajes">
								<span class="nav-icon">
									<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
										<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
									</svg>
								</span>
								<span class="nav-label">Mensajes</span>
							</a>
						</li>
						{% if app.user %}
							<li>
								<a href="{{ path('app_perfil') }}" title="Perfil">
									<span class="nav-icon">
										<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
											<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
											<circle cx="12" cy="7" r="4"/>
										</svg>
									</span>
									<span class="nav-label">Perfil</span>
								</a>
							</li>
							<li>
								<a href="{{ path('app_logout') }}" data-turbo="false" title="Cerrar sesión">
									<span class="nav-icon">
										<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
											<path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
											<polyline points="16 17 21 12 16 7"/>
											<line x1="21" y1="12" x2="9" y2="12"/>
										</svg>
									</span>
									<span class="nav-label">Cerrar sesión</span>
								</a>
							</li>
						{% else %}
							<li>
								<a href="{{ path('app_login') }}" title="Login">
									<span class="nav-icon">
										<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
											<path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
											<polyline points="10 17 15 12 10 7"/>
											<line x1="15" y1="12" x2="3" y2="12"/>
										</svg>
									</span>
									<span class="nav-label">Login</span>
								</a>
							</li>
						{% endif %}
					</ul>
				</nav>

				{% if is_granted('IS_AUTHENTICATED_FULLY') %}
					<button class="publicar" onclick="abrirModal()">
						<span class="nav-icon publicar-icon">
							<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
								<line x1="12" y1="5" x2="12" y2="19"/>
								<line x1="5" y1="12" x2="19" y2="12"/>
							</svg>
						</span>
						<span class="nav-label">Publicar</span>
					</button>
				{% else %}
					<a href="{{ path('app_login') }}" class="publicar" style="text-decoration:none; text-align:center;">
						<span class="nav-icon publicar-icon">
							<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
								<line x1="12" y1="5" x2="12" y2="19"/>
								<line x1="5" y1="12" x2="19" y2="12"/>
							</svg>
						</span>
						<span class="nav-label">Publicar</span>
					</a>
				{% endif %}

				<div class="theme-toggle-container">
					<button id="btn-light" class="theme-btn active">
						<span class="nav-icon">
							<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<circle cx="12" cy="12" r="5"/>
								<line x1="12" y1="1" x2="12" y2="3"/>
								<line x1="12" y1="21" x2="12" y2="23"/>
								<line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
								<line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
								<line x1="1" y1="12" x2="3" y2="12"/>
								<line x1="21" y1="12" x2="23" y2="12"/>
								<line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
								<line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
							</svg>
						</span>
						<span class="nav-label">Día</span>
					</button>
					<button id="btn-dark" class="theme-btn">
						<span class="nav-icon">
							<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
								<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
							</svg>
						</span>
						<span class="nav-label">Noche</span>
					</button>
				</div>

				<div class="menu-bar">
					<img id="toggle-menu" src="{{ asset('multimedia/menu_bar.png') }}" alt="Menu bar">
				</div>
			</aside>

			<!-- Contenido principal (Feed) -->
			<main class="feed">
				{% for label, messages in app.flashes %}
					{% for message in messages %}
						<div class="flash-{{ label }}">
							{{ message }}
						</div>
					{% endfor %}
				{% endfor %}

				{% block body %}{% endblock %}
			</main>

			<!-- Barra lateral derecha -->
			{% block right_sidebar %}
				{{ render(controller('App\\Controller\\PageController::rankingWidget')) }}
			{% endblock %}
		</div>

		<!-- Flecha para que se pueda plegar/desplegar el menú -->
		<div class="toggle-arrow" id="toggle-arrow">
			<img src="{{ asset('multimedia/arrow.png') }}" alt="Flecha para plegar/desplegar el menú">
		</div>

		<!-- Confirm Modal -->
		<div id="global-confirm-blur" class="blur" style="display: none; z-index: 9999;" onclick="closeConfirmModal()"></div>
		<div id="global-confirm-modal" class="modal-publicar" style="display: none; z-index: 10000;" role="dialog" aria-modal="true">
			<div class="modal-publicar-inner">
				<div class="modal-publicar-header">
					<span id="confirm-modal-title">Confirmar acción</span>
					<button class="modal-cerrar" onclick="closeConfirmModal()" aria-label="Cerrar">✕</button>
				</div>
				<div class="modal-publicar-body" style="text-align: center; padding: 20px;">
					<p id="confirm-modal-message" style="margin-bottom: 20px; font-size: 1.1rem; color: var(--text-color);">¿Estás seguro?</p>
					<div style="display: flex; justify-content: center; gap: 15px; margin-top: 10px;">
						<button type="button" class="btn-cancelar" onclick="closeConfirmModal()" style="padding: 10px 20px; border-radius: 20px; border: 1px solid var(--text-color); background: transparent; cursor: pointer; color: var(--text-color); font-weight: 600;">Cancelar</button>
						<button type="button" id="confirm-modal-yes" class="btn-publicar-modal" style="background-color: #ff4d4d; color: white;">Confirmar</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Scripts-->
	</body>
</html>
